# 网络知识

**URL：**`同一资源定位符，即：网址，网址的格式为：《协议》://《域名或IP》:《端口》/《路径》，其中协议和IP是必须的`

**http协议：**`超文本传输协议，浏览器和服务器之间的交互需要依赖于http协议，该协议的作用是让浏览器和服务器之间可以进行交互的数据以固定的格式存放好，方便进行读取`

**IP：**`即每个连接到Internet上的主机都会随机分配一个IP地址，IP地址是用来唯一的标识互联网上计算机的逻辑地址，机器之间的交互就是通过IP地址来进行的`

**域名：**`在IP地址的基础上发展的便于书写和记忆的一种符号化的地址方案，来代替数字型的IP地址，一个域名对应一个IP，但一个IP可以拥有多个域名`

**DNS：**`虽然域名便于我们我们记忆，但机器之间只能互相认识IP地址，它们之间的转换工作称为域名解析，DNS就是进行域名解析的服务器`

**端口（port）：**`类似于门牌号码，客户端可以通过IP地址找到对应的服务器端，但是服务器端有很多端口号，每个应用程序对应着一个端口号，通过类似门牌号的端口号，客户端才能真正的访问到该服务器`

**路径：**`端口号后面跟着的具体资源路径`

**状态码：**`当浏览者访问一个网页时，浏览者的浏览器会向网页所在服务器发出请求。当浏览器接收并显示网页前，此网页所在的服务器会返回一个包含HTTP状态码的信息头（server header）用以响应浏览器的请求，其中 1XX代表临时响应、2XX代表请求成功、3XX代表重定向、4XX客户端请求错误、5XX服务器错误`

**从浏览器输入网址到看到页面经历的过程**

- 浏览器会访问DNS服务器将输入的域名对应的IP获取到
- 浏览通过HTTP协议和IP协议处理发送的建立连接的请求然后发送到互联网
- 在互联网中路由器根据目标IP地址，通过复杂的算法找出'最优路径'来传输请求
- 找到目标IP计算机(服务器)的网卡通过三次握手建立连接
- 服务器对请求进行分析处理然后返回浏览器需要的页面
- 浏览器拿到数据会对DOM结构和CSS进行分析形成renderTree然后渲染到页面上
- 在渲染的过程中有需要从服务器请求的资源，会重复1-6的过程

------

### 跨域

**什么是跨域：**`跨域指的是 协议（protocol），域名（host），端口号（post）都不相同的资源之间尝试进行交互通行，而由于受到浏览器同源策略的限制，无法正常进行交互通信。当协议、域名、端口号相同时称之为同源`

**同源策略：**`同源策略限制了从一个源加载的文档或脚本如何与另一个源的资源进行交互，这是一个用于隔离潜在恶意文件的重要安全机制,其目的是为了防止XSS、CSRF、cookie窃取等恶意攻击`

**同源策略的三种交互方式**

- 允许跨域的~写操作，如：链接、重定向
- 允许跨域嵌套资源，如：img、script标签等
- 不允许跨域~读操作

**受同源策略限制的**

- Ajax通信（可以发送，浏览器不会反应）
- 获取网页存储信息，cookie，localStorage，indexDB
- 操作dom（例如操作iframe里的dom）

**不受同源策略限制的**

script、img、link、iframe等待src属性的标签

`为什么它们可以被允许跨域嵌入`

- 首先，网站的JS脚本、图片、音频等资源不一定是放在存储网站页面的服务器上的，可能会通过别的方式将资源传送到浏览器中；
- 其次，网站的编写人员正常情况下并不会故意加载恶意脚本到网站中，所以，我们默认正常网页的脚本是安全的；
- 最后，对于当前页面来说，页面内加载的JS文件本身放在哪里并不重要，只要它被谁加载了，就和谁同源。例如：a.js这个JS文件，原本在x.com页面中，后来它被y.com这个页面加载了，这个时候，a.js就和y.com这个页面同源，而不是x.com。

**跨域的解决方案**

`首先要明白一点，如果是协议和端口造成的跨域问题前端是无法解决的`

[CORS跨域](C:\Users\地主兄\Desktop\面试准备\DEMO\CORS跨域\index.html)

`CORS（Cross-Origin Resource Sharing）跨域资源共享，定义了必须在访问跨域资源时，浏览器与服务器应该如何沟通。CORS背后的基本思想就是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是失败。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。整个CORS通信过程，都是浏览器自动完成，不需要用户参与。对于开发者来说，CORS通信与同源的AJAX通信没有差别，代码完全一样。浏览器一旦发现AJAX请求跨源，就会自动添加一些附加的头信息，有时还会多出一次附加的请求，但用户不会有感觉。`

```js
//服务端设置 Access-Control-Allow-Origin 字段，值可以是具体的域名或者 '*' 通配符，配置好后就可以允许跨域请求数据。 
//例如在node环境下
res.writeHead(200, {
    'Access-Control-Allow-Origin': '*'
});
```

CORS和JSONP对比

- JSONP只能实现GET请求，而CORS支持所有类型的HTTP请求。
- 使用CORS，开发者可以使用普通的XMLHttpRequest发起请求和获得数据，比起JSONP有更好的错误处理。
- JSONP主要被老的浏览器支持，它们往往不支持CORS，而绝大多数现代浏览器都已经支持了CORS）。

CORS与JSONP相比，无疑更为先进、方便和可靠。

[Jsonp跨域](C:\Users\地主兄\Desktop\面试准备\DEMO\jsonp跨域\index.html)

利用src属性不受浏览器同源策略限制的特性，通过动态创建一个script标签，请求一个带参的网址来实现跨域通行

```js
//前端逻辑
<script>
    function fn(data){
        console.log(data)
    }
</script>
<script src="http://127.0.0.1:8080?callback=fn"></script>
```

```js
//后端逻辑
require('http').createServer(function(req, res) {
    var data = {
        name:'小明',
        sex:'男'
    };
    var fn = url.parse(req.url,true).query.callback;
    res.writeHead(200)
    res.end(`${fn}(${JSON.stringify(data)})`)
}).listen(8080, '127.0.0.1',function(){
    console.log('启动服务，监听 127.0.0.1:8080');
})
```

